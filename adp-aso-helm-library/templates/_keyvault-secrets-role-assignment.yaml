{{- define "adp-aso-helm-library.keyvault-secrets-role-assignment" -}}
{{- $requiredMsg := include "adp-aso-helm-library.default-check-required-msg" . }}
{{- $subscriptionId := required (printf $requiredMsg "subscriptionId") $.Values.subscriptionId }}
{{- $infraResourceGroupName := required (printf $requiredMsg "infraResourceGroupName") $.Values.infraResourceGroupName }}
{{- $keyVaultName := required (printf $requiredMsg "keyVaultName") $.Values.keyVaultName }}
{{- $keyVaultSecretsObject := required (printf $requiredMsg "keyVaultSecrets") .Values.keyVaultSecrets }}
{{- range $keyVaultSecret := .Values.keyVaultSecrets }}
{{- include "adp-aso-helm-library.role-assignment-managed" (list $ $keyVaultSecret.roleAssignments $keyVaultSecret.name "keyVaultSecret") }}  
{{- end }}
{{- end }}